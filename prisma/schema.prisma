generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  name               String?
  email              String?             @unique
  emailVerified      DateTime?
  subscriptionId     String? // ID da assinatura individual (não usado atualmente)
  image              String?
  password           String?
  role               UserRole            @default(USER)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  accounts           Account[]
  VerificationCode   VerificationCode[]
  memberships        Membership[]
  membershipRequests MembershipRequest[]
}

model Organization {
  id                   String              @id @default(uuid())
  name                 String
  description          String?
  logo                 String?
  stripeCustomerId     String?             @unique // ID do cliente no Stripe
  stripeSubscriptionId String?             @unique // ID da assinatura no Stripe
  stripePriceId        String? // ID do preço atual no Stripe
  subscriptionStatus   String? // Status da assinatura (active, trialing, past_due, canceled)
  planId               String? // ID do plano (free, pro, enterprise)
  currentPeriodEnd     DateTime? // Quando a assinatura atual termina
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  memberships          Membership[]
  invitations          Invitation[]
  membershipRequests   MembershipRequest[]
}

model Membership {
  id             String       @id @default(uuid())
  userId         String
  organizationId String
  role           MemberRole   @default(MEMBER)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId])
}

model MembershipRequest {
  id             String        @id @default(uuid())
  userId         String
  organizationId String
  status         RequestStatus @default(PENDING)
  message        String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([userId])
  @@index([status])
}

model VerificationCode {
  id        String   @id @default(cuid())
  userId    String
  email     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, email])
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model VerificationToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model Invitation {
  id             String       @id @default(uuid())
  email          String
  token          String       @unique
  organizationId String
  role           MemberRole   @default(MEMBER)
  createdAt      DateTime     @default(now())
  expiresAt      DateTime
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([email, organizationId])
  @@index([organizationId])
  @@index([token])
}

enum UserRole {
  ADMIN
  USER
}

enum MemberRole {
  OWNER
  ADMIN
  MEMBER
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}
